#########################################################################
# 
# PPoseek Web Application - Spring Boot Configuration
# 
# Copyright(c) 2025 ROUNDERS. All rights reserved.
# This software is the proprietary information of ROUNDERS.
# 
#########################################################################

# ==============================================================================
# Spring Boot Core Configuration
# ==============================================================================
spring:
  application:
    name: pposeek-spring-backend                                    # ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ë¦„
  
  # ------------------------------------------------------------------------------
  # í”„ë¡œíŒŒì¼ ì„¤ì • (ë‹¨ì¼ í™˜ê²½)
  # ------------------------------------------------------------------------------
  # profiles:
  #   active: dev   # í”„ë¡œíŒŒì¼ ë¶„ë¦¬ ì—†ì´ ë‹¨ì¼ ì„¤ì • ì‚¬ìš©
  
  # ------------------------------------------------------------------------------
  # ë°ì´í„°ì†ŒìŠ¤ ì„¤ì • (H2 In-Memory Database)
  # ------------------------------------------------------------------------------
  datasource:
    url: jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE  # H2 ë©”ëª¨ë¦¬ ë°ì´í„°ë² ì´ìŠ¤ URL (ê³ ì •)
    driver-class-name: org.h2.Driver                   # H2 JDBC ë“œë¼ì´ë²„
    username: sa                                       # ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©ìëª…
    password: password                                 # ë°ì´í„°ë² ì´ìŠ¤ ë¹„ë°€ë²ˆí˜¸
    hikari:
      jdbc-url: jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE  # HikariCPìš© URL ê³ ì •
  # ==============================================================================
  # Kafka Configuration
  # ==============================================================================
  kafka:
    bootstrap-servers: kafka:9092
    consumer:
      group-id: pposeek_group
      auto-offset-reset: earliest
      # Consumerê°€ DTOë¥¼ ì§ì ‘ ë°›ë„ë¡ JSON Deserializer ì„¤ì •
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer
      properties:
        spring.json.trusted.packages: "*"
        # íƒ€ì… ë§¤í•‘ ì¶”ê°€ - Pythonì—ì„œ ë³´ë‚¸ JSONì„ ì§ì ‘ DTOë¡œ ë³€í™˜
        spring.json.type.mapping: >
          analysis_feedback:com.rounders.pposeek.common.model.dto.kafka.AnalysisFeedback,
          notification:com.rounders.pposeek.common.model.dto.kafka.Notification
        # íƒ€ì… í—¤ë” ì‚¬ìš© ì•ˆí•¨ (Pythonì—ì„œ ë³´ë‚´ì§€ ì•Šìœ¼ë¯€ë¡œ)
        spring.json.use.type.headers: false
        # ê¸°ë³¸ íƒ€ì…ìœ¼ë¡œ ë³€í™˜ í—ˆìš©
        spring.deserializer.value.delegate.class: org.apache.kafka.common.serialization.StringDeserializer
    producer:
      # Producerê°€ DTOë¥¼ ì§ì ‘ ë³´ë‚´ë„ë¡ JSON Serializer ì„¤ì •
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer
    
  # ------------------------------------------------------------------------------
  # H2 Database Console ì„¤ì • (ê°œë°œìš©)
  # ------------------------------------------------------------------------------
  h2:
    console:
      enabled: true                                    # H2 ì›¹ ì½˜ì†” í™œì„±í™”
      path: /h2-console                                # H2 ì½˜ì†” ì ‘ê·¼ ê²½ë¡œ
      settings:
        web-allow-others: true                         # ì™¸ë¶€ ì ‘ê·¼ í—ˆìš© (ê°œë°œí™˜ê²½ë§Œ)
        # H2 ì½˜ì†”ì—ì„œ ì‚¬ìš©í•  ê³ ì • URL ì„¤ì •
        trace: false                                   # íŠ¸ë ˆì´ìŠ¤ ë¹„í™œì„±í™”
        web-admin-password: ""                         # ê´€ë¦¬ì íŒ¨ìŠ¤ì›Œë“œ (ë¹ˆ ê°’ìœ¼ë¡œ ì„¤ì •)
        
  # ------------------------------------------------------------------------------
  # SQL ì´ˆê¸°í™” ì„¤ì •
  # ------------------------------------------------------------------------------
  sql:
    init:
      mode: always                                     # SQL ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ëª¨ë“œ (always, embedded, never)
      schema-locations: classpath:schema.sql           # DDL ìŠ¤í¬ë¦½íŠ¸ ìœ„ì¹˜
      continue-on-error: false                         # ì—ëŸ¬ ë°œìƒ ì‹œ ì¤‘ë‹¨ ì—¬ë¶€

# ==============================================================================
# MyBatis Configuration
# ==============================================================================
mybatis:
  # XML ë§¤í¼ íŒŒì¼ ìœ„ì¹˜
  mapper-locations: classpath:mappers/**/*.xml         # MyBatis XML ë§¤í¼ ê²½ë¡œ íŒ¨í„´
  
  # íƒ€ì… ë³„ì¹­ íŒ¨í‚¤ì§€ (DTO/Domain í´ë˜ìŠ¤)
  type-aliases-package: com.rounders.pposeek.common.model
  
  # MyBatis ì„¤ì •
  configuration:
    map-underscore-to-camel-case: true                # snake_case â†’ camelCase ìë™ ë³€í™˜
    default-fetch-size: 100                           # ê¸°ë³¸ í˜ì¹˜ í¬ê¸°
    default-statement-timeout: 30                     # SQL ì‹¤í–‰ íƒ€ì„ì•„ì›ƒ (ì´ˆ)
    lazy-loading-enabled: true                        # ì§€ì—° ë¡œë”© í™œì„±í™”
    multiple-result-sets-enabled: true                # ë‹¤ì¤‘ ê²°ê³¼ì…‹ ì§€ì›
    use-column-label: true                            # ì»¬ëŸ¼ ë¼ë²¨ ì‚¬ìš©
    use-generated-keys: true                          # ìë™ ìƒì„± í‚¤ ì‚¬ìš©
    auto-mapping-behavior: partial                    # ìë™ ë§¤í•‘ ë™ì‘ (none, partial, full)
    
# ==============================================================================
# Server Configuration
# ==============================================================================
server:
  port: 8080                                          # ì„œë²„ í¬íŠ¸
  servlet:
    context-path: /                                   # ì»¨í…ìŠ¤íŠ¸ ê²½ë¡œ
    encoding:
      charset: UTF-8                                  # ë¬¸ì ì¸ì½”ë”©
      enabled: true                                   # ì¸ì½”ë”© í•„í„° í™œì„±í™”
      force: true                                     # ê°•ì œ ì¸ì½”ë”© ì ìš©
  error:
    include-message: always                           # ì—ëŸ¬ ë©”ì‹œì§€ í¬í•¨
    include-stacktrace: on_param                      # ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ í¬í•¨ ì¡°ê±´

# ==============================================================================
# Spring Doc (Swagger) Configuration
# ==============================================================================
springdoc:
  api-docs:
    path: /v3/api-docs                                # OpenAPI 3 ë¬¸ì„œ ê²½ë¡œ
    enabled: true                                     # API ë¬¸ì„œ í™œì„±í™”
  swagger-ui:
    path: /swagger-ui.html                            # Swagger UI ê²½ë¡œ
    enabled: true                                     # Swagger UI í™œì„±í™”
    operations-sorter: method                         # ì‘ì—… ì •ë ¬ ë°©ì‹
    tags-sorter: alpha                                # íƒœê·¸ ì •ë ¬ ë°©ì‹
    display-request-duration: true                    # ìš”ì²­ ì‹œê°„ í‘œì‹œ

# ==============================================================================
# Management & Actuator Configuration (ë°°í¬ ê°€ëŠ¥í•œ ì„¤ì •)
# ==============================================================================
management:
  endpoints:
                   
    web:
      exposure:
        include: prometheus,health,info      # í•„ìˆ˜ ëª¨ë‹ˆí„°ë§ ì—”ë“œí¬ì¸íŠ¸ë§Œ ë…¸ì¶œ
      base-path: /actuator
  endpoint:
    health:
      enabled: true                                   # í—¬ìŠ¤ì²´í¬ í™œì„±í™”
      show-details: always                 # ì¸ì¦ëœ ì‚¬ìš©ìì—ê²Œë§Œ ìƒì„¸ì •ë³´
    metrics:
      enabled: true                                   # ë©”íŠ¸ë¦­ ìˆ˜ì§‘ í™œì„±í™”
    prometheus:  
      enabled: true                                   # Prometheus ì—°ë™ ì¤€ë¹„
  metrics:
    export:
      prometheus:
        enabled: true                                 # Prometheus ë©”íŠ¸ë¦­ ë‚´ë³´ë‚´ê¸°
  security:
    enabled: false  # ğŸ”‘ ì´ê²Œ í•µì‹¬! Actuator ë³´ì•ˆ ë¹„í™œì„±í™”

# ==============================================================================
# Logging Configuration (ê°œë°œ + ë°°í¬ ê²¸ìš©)
# ==============================================================================
logging:
  level:
    # ë£¨íŠ¸ ë¡œê·¸ ë ˆë²¨
    root: INFO
    
    # íŒ¨í‚¤ì§€ë³„ ë¡œê·¸ ë ˆë²¨ (ê°œë°œì‹œ ìƒì„¸ ë¡œê·¸)
    com.rounders.pposeek: DEBUG                       # ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸ (ìƒì„¸)
    org.springframework.security: DEBUG              # Spring Security ë¡œê·¸ (ìƒì„¸)
    org.mybatis: DEBUG                               # MyBatis ë¡œê·¸ (ìƒì„¸)
    org.springframework.web: DEBUG                    # Spring Web ë¡œê·¸ (ìƒì„¸)
    org.springframework.web.servlet.DispatcherServlet: DEBUG  # ìš”ì²­ ë§¤í•‘ ë¡œê·¸
    
  # ë¡œê·¸ íŒ¨í„´ ì„¤ì •
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"
    
  # ë¡œê·¸ íŒŒì¼ ì„¤ì • (ë°°í¬ì‹œì—ë„ ìœ ìš©)
  file:
    name: logs/pposeek.log                            # ë¡œê·¸ íŒŒì¼ ê²½ë¡œ
  logback:
    rollingpolicy:
      max-file-size: 10MB                             # ê°œë³„ íŒŒì¼ ìµœëŒ€ í¬ê¸°
      max-history: 30                                 # ë³´ê´€ ì¼ìˆ˜
      total-size-cap: 100MB                           # ì „ì²´ ìµœëŒ€ í¬ê¸°

# ==============================================================================
# Encryption & Security Configuration
# ==============================================================================
app:
  encryption:
    # ê°œì¸ì •ë³´ ì•”í˜¸í™” í‚¤ (AES-256ìš©)
    personal-key: ${PERSONAL_DATA_ENCRYPTION_KEY:pposeek-personal-data-encryption-key-for-aes256-must-be-32-chars-minimum}
    # ì´ë ¥ì„œ ì•”í˜¸í™” í‚¤ (AES-256ìš©)  
    resume-key: ${RESUME_DATA_ENCRYPTION_KEY:pposeek-resume-data-encryption-key-for-aes256-must-be-32-chars-minimum}
    # ë¹„ë°€ë²ˆí˜¸ í•´ì‹œìš© Salt í‚¤ (SHA-512ìš©)
    salt-key: ${PASSWORD_SALT_KEY:pposeek-password-salt-key-for-sha512-hashing-must-be-32-chars-minimum}
  frontend:
    url: ${FRONTEND_URL:http://localhost:3000}        # í”„ë¡ íŠ¸ì—”ë“œ URL (CORSìš©)

# JWT í† í° ì„¤ì •
jwt:
  secret: ${JWT_SECRET:pposeek-jwt-secret-key-for-token-signing-must-be-32-chars-minimum}
  expiration: ${JWT_EXPIRATION:86400}                 # 24ì‹œê°„ (ì´ˆ ë‹¨ìœ„)

# ==============================================================================
# Azure Blob Storage Configuration
# ==============================================================================
azure:
  blob:
    connection-string: ${AZURE_BLOB_CONN_STRING}
    container-name: ${AZURE_BLOB_CONTAINER}